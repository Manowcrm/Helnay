<div class="container mt-4">
	<div class="row mb-4">
		<div class="col">
			<h2><i class="bi bi-sliders"></i> Manage Filter Services</h2>
			<p class="text-muted">Add, edit, or remove sidebar filter options that appear on the homepage</p>
		</div>
		<div class="col-auto">
			<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addFilterModal">
				<i class="bi bi-plus-circle"></i> Add New Filter
			</button>
		</div>
	</div>

	<!-- Filter Services by Category -->
	<% Object.keys(filtersByCategory).forEach(function(category) { %>
		<div class="card mb-4">
			<div class="card-header bg-primary text-white">
				<h5 class="mb-0"><i class="bi bi-tag"></i> <%= category %> (<%= filtersByCategory[category].length %>)</h5>
			</div>
			<div class="card-body">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead>
							<tr>
								<th>Order</th>
								<th>Name</th>
								<th>Icon Preview</th>
								<th>Icon Code</th>
								<th>Filter Key</th>
								<th>Status</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							<% filtersByCategory[category].forEach(function(filter) { %>
								<tr>
									<td><span class="badge bg-secondary"><%= filter.display_order %></span></td>
									<td><strong><%= filter.name %></strong></td>
									<td>
										<i class="bi bi-<%= filter.icon %>" style="font-size: 1.5rem; color: #667eea;"></i>
									</td>
									<td><code>bi-<%= filter.icon %></code></td>
									<td><code><%= filter.filter_key %></code></td>
									<td>
										<% if (filter.is_active) { %>
											<span class="badge bg-success">Active</span>
										<% } else { %>
											<span class="badge bg-secondary">Inactive</span>
										<% } %>
									</td>
									<td>
										<div class="btn-group btn-group-sm" role="group">
											<button class="btn btn-outline-primary" onclick="editFilter(<%= filter.id %>, '<%= filter.category %>', '<%= filter.name %>', '<%= filter.icon %>', '<%= filter.filter_key %>', <%= filter.display_order %>, <%= filter.is_active %>)">
												<i class="bi bi-pencil"></i>
											</button>
											<form method="POST" action="/admin/filters/<%= filter.id %>/toggle" style="display:inline;">
												<button type="submit" class="btn btn-outline-<%= filter.is_active ? 'warning' : 'success' %>">
													<i class="bi bi-<%= filter.is_active ? 'eye-slash' : 'eye' %>"></i>
												</button>
											</form>
											<form method="POST" action="/admin/filters/<%= filter.id %>/delete" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this filter?');">
												<button type="submit" class="btn btn-outline-danger">
													<i class="bi bi-trash"></i>
												</button>
											</form>
										</div>
									</td>
								</tr>
							<% }); %>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	<% }); %>

	<!-- Info Card -->
	<div class="alert alert-info">
		<h5><i class="bi bi-info-circle"></i> How to Use</h5>
		<ul>
			<li><strong>Filter Key:</strong> The text that will be searched in listing descriptions (lowercase, e.g., "wifi", "pool")</li>
			<li><strong>Icon Code:</strong> Bootstrap icon name without the "bi-" prefix (see <a href="https://icons.getbootstrap.com/" target="_blank">Bootstrap Icons</a>)</li>
			<li><strong>Display Order:</strong> Lower numbers appear first within each category</li>
			<li><strong>Active/Inactive:</strong> Only active filters appear on the homepage sidebar</li>
		</ul>
	</div>
</div>

<!-- Add Filter Modal -->
<div class="modal fade" id="addFilterModal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<form method="POST" action="/admin/filters/create">
				<div class="modal-header">
					<h5 class="modal-title"><i class="bi bi-plus-circle"></i> Add New Filter</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<div class="mb-3">
						<label class="form-label">Category</label>
						<select class="form-select" name="category" required>
							<option value="">Select Category...</option>
							<option value="Services">Services</option>
							<option value="Accommodation Type">Accommodation Type</option>
							<option value="Activities">Activities</option>
							<option value="Custom">Custom (New Category)</option>
						</select>
						<div class="form-text">Or type a new category name below</div>
						<input type="text" class="form-control mt-2" name="custom_category" placeholder="New category name (optional)">
					</div>
					<div class="mb-3">
						<label class="form-label">Filter Name</label>
						<input type="text" class="form-control" name="name" placeholder="e.g., WiFi, Pool, Pet-Friendly" required>
					</div>
					<div class="mb-3">
						<label class="form-label">Bootstrap Icon (without bi- prefix)</label>
						<input type="text" class="form-control" name="icon" placeholder="e.g., wifi, water, heart" required>
						<div class="form-text">Browse icons at <a href="https://icons.getbootstrap.com/" target="_blank">Bootstrap Icons</a></div>
					</div>
					<div class="mb-3">
						<label class="form-label">Filter Key (search term)</label>
						<input type="text" class="form-control" name="filter_key" placeholder="e.g., wifi, pool, pet-friendly" required>
						<div class="form-text">This will be searched in listing descriptions (lowercase)</div>
					</div>
					<div class="mb-3">
						<label class="form-label">Display Order</label>
						<input type="number" class="form-control" name="display_order" value="0" min="0">
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-primary">
						<i class="bi bi-check-circle"></i> Add Filter
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

<!-- Edit Filter Modal -->
<div class="modal fade" id="editFilterModal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<form method="POST" id="editFilterForm">
				<div class="modal-header">
					<h5 class="modal-title"><i class="bi bi-pencil"></i> Edit Filter</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<div class="mb-3">
						<label class="form-label">Category</label>
						<input type="text" class="form-control" name="category" id="edit_category" required>
					</div>
					<div class="mb-3">
						<label class="form-label">Filter Name</label>
						<input type="text" class="form-control" name="name" id="edit_name" required>
					</div>
					<div class="mb-3">
						<label class="form-label">Bootstrap Icon (without bi- prefix)</label>
						<input type="text" class="form-control" name="icon" id="edit_icon" required>
					</div>
					<div class="mb-3">
						<label class="form-label">Filter Key (search term)</label>
						<input type="text" class="form-control" name="filter_key" id="edit_filter_key" required>
					</div>
					<div class="mb-3">
						<label class="form-label">Display Order</label>
						<input type="number" class="form-control" name="display_order" id="edit_display_order" min="0">
					</div>
					<div class="mb-3 form-check">
						<input type="checkbox" class="form-check-input" name="is_active" id="edit_is_active">
						<label class="form-check-label" for="edit_is_active">Active (show on homepage)</label>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-primary">
						<i class="bi bi-save"></i> Save Changes
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

<script>
	function editFilter(id, category, name, icon, filter_key, display_order, is_active) {
		document.getElementById('editFilterForm').action = '/admin/filters/' + id + '/update';
		document.getElementById('edit_category').value = category;
		document.getElementById('edit_name').value = name;
		document.getElementById('edit_icon').value = icon;
		document.getElementById('edit_filter_key').value = filter_key;
		document.getElementById('edit_display_order').value = display_order;
		document.getElementById('edit_is_active').checked = is_active === 1;
		
		new bootstrap.Modal(document.getElementById('editFilterModal')).show();
	}
	
	// Handle custom category input
	document.querySelector('select[name="category"]').addEventListener('change', function() {
		const customInput = document.querySelector('input[name="custom_category"]');
		if (this.value === 'Custom') {
			customInput.required = true;
			customInput.focus();
		} else {
			customInput.required = false;
		}
	});
	
	// Use custom category if provided
	document.querySelector('form[action="/admin/filters/create"]').addEventListener('submit', function(e) {
		const categorySelect = this.querySelector('select[name="category"]');
		const customInput = this.querySelector('input[name="custom_category"]');
		
		if (customInput.value.trim()) {
			categorySelect.disabled = true;
			const hiddenInput = document.createElement('input');
			hiddenInput.type = 'hidden';
			hiddenInput.name = 'category';
			hiddenInput.value = customInput.value.trim();
			this.appendChild(hiddenInput);
		}
	});
</script>
