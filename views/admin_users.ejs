<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Manage Users</h1>
    <div>
      <span class="badge bg-primary fs-6">Total Users: <%= users.length %></span>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Registered</th>
          <th>Last Login</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% users.forEach(function(u){ %>
          <tr>
            <td><%= u.id %></td>
            <td><%= u.name %></td>
            <td><%= u.email %></td>
            <td>
              <% if (u.role === 'super_admin') { %>
                <span class="badge bg-danger"><i class="bi bi-shield-fill-check"></i> Super Admin</span>
              <% } else if (u.role === 'admin') { %>
                <span class="badge bg-warning"><i class="bi bi-shield-fill"></i> Admin</span>
              <% } else { %>
                <span class="badge bg-secondary"><i class="bi bi-person-fill"></i> User</span>
              <% } %>
            </td>
            <td>
              <%= u.created_at ? new Date(u.created_at).toLocaleDateString() : 'N/A' %>
              <small class="text-muted d-block">
                <%= u.created_at ? new Date(u.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '' %>
              </small>
            </td>
            <td>
              <% if (u.last_login) { %>
                <%= new Date(u.last_login).toLocaleDateString() %>
                <small class="text-muted d-block">
                  <%= new Date(u.last_login).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
                </small>
              <% } else { %>
                <span class="text-muted">Never logged in</span>
              <% } %>
            </td>
            <td>
              <a href="/admin/users/<%= u.id %>/bookings" class="btn btn-sm btn-info">
                <i class="bi bi-calendar"></i> Bookings
              </a>
              <% if (u.role !== 'admin' && u.role !== 'super_admin') { %>
                <form method="POST" action="/admin/users/<%= u.id %>/delete" style="display:inline;">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('⚠️ Delete this user?\n\nThis will permanently remove:\n- User account\n- All their bookings\n- All their data\n\nThis action cannot be undone!')">
                    <i class="bi bi-trash"></i> Delete
                  </button>
                </form>
              <% } else { %>
                <span class="badge bg-secondary"><i class="bi bi-lock-fill"></i> Protected</span>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <% if (users.length === 0) { %>
    <div class="alert alert-info">
      <i class="bi bi-info-circle"></i> No users found in the database.
    </div>
  <% } %>
</div>
